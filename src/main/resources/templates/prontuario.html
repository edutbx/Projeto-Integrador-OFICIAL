<script src="/js/auth.js"></script>
<script>
// Detecta perfil dev automaticamente via endpoint
fetch('/api/profile')
    .then(r => r.json())
    .then(profile => {
        window.perfilDevAtivo = !!profile.dev;
        protegerPagina();
        // Exemplo: carregar dados protegidos se necessário
        // const token = getToken();
        // if (token || window.perfilDevAtivo) { ... }
    });
</script>
</html>
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Médico</title>
    <!-- Importa os estilos do prontuário -->
    <link rel="stylesheet" href="/CSS/styleMedico/styleMedicoGenerico.css">
    <link rel="stylesheet" href="/CSS/styleMedico/styleProntuario.css">
</head>

<body>

    <!-- Cabeçalho com informações do médico -->
    <header>
        <img src="/img/Logo.png" alt="Logo Saúde++" class="logo">
        <div class="perfil">
            <div class="perfil-info">
                <p>Guilerme Celho Pix</p>
                <p>CRM:345678987654</p>
                <p>Especialidade</p>
            </div>
            <img src="/img/icon.png" alt="" class="perfil-foto" style="height: 50px;">
        </div>
    </header>

    <!-- Área principal do prontuário do paciente -->
    <main>
        <div class="prontuarioPaciente">
            <h2>Prontuário do Paciente</h2>
            <p><strong>Nome:</strong> João Silva</p>
            <p><strong>Idade:</strong> 34 anos</p>
            <p><strong>Sexo:</strong> Masculino</p>
            <p><strong>CPF:</strong> 123.456.789-00</p>
            <p><strong>Endereço:</strong> Rua das Flores, 123 - São Paulo/SP</p>
            <p><strong>Telefone:</strong> (11) 98765-4321</p>
            <hr>
            <p><strong>Histórico Médico:</strong> Hipertensão, Alergia a dipirona</p>
            <p><strong>Medicamentos em uso:</strong> Losartana 50mg/dia</p>
            <p><strong>Última consulta:</strong> 10/08/2025</p>
            <p><strong>Observações:</strong> Recomendado acompanhamento trimestral</p>
        </div>

        <div class="botoes">
            <!-- Botão consultar prontuários antigos (agora acima) -->
            <button type="button" id="consultarBtn" class="consultar iniciar-consulta">Consultar prontuários antigos</button>
            <!-- Botão interpretar prontuário -->
            <button type="button" id="interpretarBtn" class="interpretar iniciar-consulta">Interpretar prontuário</button>
            <!-- Campo para escolher o arquivo, agora abaixo do interpretar -->
            <form id="pdfForm" enctype="multipart/form-data" style="margin:0;">
                <input type="file" id="pdfFile" name="file" accept="application/pdf" required>
            </form>
            <!-- Campo para exibir apenas o texto editado pela IA (como texto comum) -->
            <div id="respostaIA" class="resposta-ia"></div>
        </div>

        <!-- Botão voltar fixo no canto inferior esquerdo -->
        <a href="/medico" class="voltar-fixo"><button class="logout">voltar</button></a>

    <!-- Script responsável por exibir a mensagem original e a interpretada pela IA -->
    <script>
    // Função para exibir apenas o texto editado pela IA (como texto comum)
    document.getElementById('interpretarBtn').onclick = async function() {
        const form = document.getElementById('pdfForm');
        const fileInput = document.getElementById('pdfFile');
        if (!fileInput.files.length) {
            alert('Selecione um arquivo PDF!');
            return;
        }
        const formData = new FormData(form);
        // Envia o PDF para o backend
        const response = await fetch('/api/interpretar-pdf', {
            method: 'POST',
            body: formData
        });
        const result = await response.json();

        // Exibe apenas a resposta interpretada pela IA, como texto comum
        let resposta = '';
        if (result.respostaIA) {
            try {
                // Tenta extrair o campo 'resposta' do JSON retornado pela IA
                const iaObj = JSON.parse(result.respostaIA);
                resposta = iaObj.resposta || result.respostaIA;
            } catch (e) {
                resposta = result.respostaIA;
            }
        } else if (result.erroIA) {
            resposta = result.erroIA;
        } else {
            resposta = 'Nenhuma resposta da IA.';
        }
        document.getElementById('respostaIA').textContent = resposta;
    };
    </script>

</body>

</html>