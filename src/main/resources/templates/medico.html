<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Médico</title>
    <!-- Importa os estilos do painel médico -->
    <link rel="stylesheet" href="/CSS/styleMedico/styleMedicoGenerico.css">
    <link rel="stylesheet" href="/CSS/styleMedico/styleHomeMedico.css">
</head>
<body>

<!-- Cabeçalho com informações do médico -->
<header>
    <img src="/img/Logo.png" alt="Logo Saúde++" class="logo">
    <div class="perfil">
        <div class="perfil-info">
            <p>Guilerme Celho Pix</p>
            <p>CRM:345678987654</p>
            <p>Especialidade</p>
            <a href="/logout"><button class="logout">LOGOUT</button></a>
        </div>
        <img src="/img/icon.png" alt="" class="perfil-foto" style="height: 50px;">
    </div>
</header>

<!-- Agenda de consultas do médico -->

<main>
    <div class="agenda">
        <h2>Consulta hora marcada</h2>
        <div id="dados-protegidos">
            Carregando dados do médico...
        </div>
    </div>
    <a href="/novaConsulta" class="iniciar-consulta">Iniciar consulta</a>
</main>

<script src="/js/auth.js"></script>
<script>
// Detecta perfil dev automaticamente via endpoint
fetch('/api/profile')
    .then(r => r.json())
    .then(profile => {
        window.perfilDevAtivo = !!profile.dev;
    protegerPagina();
        // Carrega dados protegidos do endpoint REST usando JWT
        const token = getToken();
        if (token || window.perfilDevAtivo) {
            fetch('/api/medico', {
                headers: token ? { 'Authorization': 'Bearer ' + token } : {}
            })
            .then(r => {
                if (r.ok) return r.text();
                throw new Error('Acesso negado');
            })
            .then(texto => {
                document.getElementById('dados-protegidos').innerText = texto;
            })
            .catch(err => {
                document.getElementById('dados-protegidos').innerText = err.message;
            });
        } else {
            document.getElementById('dados-protegidos').innerText = 'Você não está autenticado!';
        }
    });
</script>
</body>

</html>